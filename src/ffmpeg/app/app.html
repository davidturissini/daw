<template>
    <header class="header">
        <ffmpeg-controls
            onstopbuttonclick={onStopButtonClick}
            onplaybuttonclick={onPlayButtonClick}>
        </ffmpeg-controls>
        <ffmpeg-audioscroll></ffmpeg-audioscroll>
    </header>
    <main>
        <section>
            <template for:each={highlights} for:item="highlight">
                <ffmpeg-highlightdetail
                    key={highlight.id}
                    highlight={highlight}>
                </ffmpeg-highlightdetail>
            </template>
        </section>
        <section class="tracks-summary">
            <header class="tracks-summary__header"></header>
            <template for:each={audioTracksArray} for:item="track">
                <article data-track-id={track.data.id} onkeyup={onTrackSummaryKeyUp} tabindex="0" class="track track--summary" key={track.data.id}>
                    <span class="track-index">{track.index}</span>
                    <h4 class="track__title">{track.data.title}</h4>
                </article>
            </template>
        </section>
        <div class="editor-container">
            <template if:true={editor.data.frame}>
                <header>
                    <ffmpeg-timeline
                        onmouseenter={onTimelineMouseEnter}
                        onmouseleave={onTimelineMouseLeave}
                        ontimelinedrag={onTimelineDrag}
                        ontimelinedragstart={onTimelineDragStart}
                        ontimelinedragend={onTimelineDragEnd}>
                    </ffmpeg-timeline>
                </header>
                <section class="editor" onmousedown={onEditorMouseDown} onmousemove={onEditorMouseMove} onmouseleave={onEditorMouseLeave}>
                    <ffmpeg-selection></ffmpeg-selection>
                    <div onclick={onEditorClick}>
                        <ffmpeg-grid></ffmpeg-grid>
                        <section class="waveforms-container" id="tracks">
                            <template for:each={audioTracksArray} for:item="track">
                                <article class="track" key={track.data.id}>
                                    <ffmpeg-audiotrack
                                        onsegmentdurationchange={onSegmentDurationChange}
                                        onsegmentsourceoffsetchange={onSegmentSourceOffsetChange}
                                        onsegmentdrag={onSegmentDrag}
                                        onsegmentdragend={onSegmentDragEnd}
                                        onsegmentdragstart={onSegmentDragStart}
                                        track={track.data}>
                                    </ffmpeg-audiotrack>
                                </article>
                            </template>
                        </section>
                    </div>
                    <template if:true={cursorInWindow}>
                        <ffmpeg-cursor time={editor.data.cursor}></ffmpeg-cursor>
                    </template>
                    <template if:true={hasVirtualCursor}>
                        <ffmpeg-cursor time={editor.data.virtualCursor} virtual></ffmpeg-cursor>
                    </template>
                    <template if:true={hasPlaybackCursor}>
                        <ffmpeg-cursor time={playhead.data.currentTime} playhead></ffmpeg-cursor>
                    </template>
                    <template if:true={hasPlaybackDurationCursor}>
                        <ffmpeg-cursor
                            oncursordoubletap={onPlaybackDurationCursorDoubleTap}
                            oncursordrag={onPlaybackDurationCursorDrag}
                            time={playhead.data.playbackRange.duration}
                            user-drag>
                        </ffmpeg-cursor>
                    </template>
                    <template for:each={highlights} for:item="highlight">
                        <ffmpeg-highlight key={highlight.id} highlight={highlight}></ffmpeg-highlight>
                    </template>
                </section>
            </template>
        </div>
        <ffmpeg-masterout></ffmpeg-masterout>
    </main>
</template>
