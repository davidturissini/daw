<template>
    <header class="header">
        <ffmpeg-controls
            onsilencedetectbuttonclick={onSilenceDetectButtonClick}
            onstopbuttonclick={onStopButtonClick}
            onplaybuttonclick={onPlayButtonClick}>
        </ffmpeg-controls>
        <ffmpeg-audioscroll></ffmpeg-audioscroll>
        <ffmpeg-instruments></ffmpeg-instruments>
    </header>
    <main>
        <aside class="selections">
            <section class="highlights">
                <template for:each={highlights} for:item="highlight">
                    <ffmpeg-highlightdetail
                        key={highlight.id}
                        highlight={highlight}>
                    </ffmpeg-highlightdetail>
                </template>
            </section>
        </aside>
        <template if:true={isEditorRoute}>
            <section class="tracks-summary">
                <header class="tracks-summary__header"></header>
                <section class="tracks">
                    <template for:each={audioTracksArray} for:item="track" for:index="index">
                        <article data-track-id={track.id} onkeyup={onTrackSummaryKeyUp} tabindex="0" class="track track--summary" key={track.id}>
                            <span class="track-index">{index}</span>
                            <h4 class="track__title">{track.title}</h4>
                        </article>
                    </template>
                </section>
            </section>
            <div class="editor-container">
                <template if:true={hasFrame}>
                    <section class="editor" onmousedown={onEditorMouseDown} onmousemove={onEditorMouseMove} onmouseleave={onEditorMouseLeave}>
                        <ffmpeg-selection></ffmpeg-selection>
                        <div onclick={onEditorClick}>
                            <ffmpeg-grid
                                ontimelinemouseenter={onTimelineMouseEnter}
                                ontimelinemouseleave={onTimelineMouseLeave}
                                ontimelinedrag={onTimelineDrag}
                                ontimelinedragstart={onTimelineDragStart}
                                ontimelinedragend={onTimelineDragEnd}
                            >
                                <template for:each={trackRows} for:item="row">
                                    <ffmpeg-gridrow
                                        data-track-id={row.trackId}
                                        onmousemove={onAudioTrackMouseMove}
                                        onmousedown={onAudioTrackMouseDown}
                                        onrangedrag={onSegmentDrag}
                                        onrangedragend={onSegmentDragEnd}
                                        onrangedragstart={onSegmentDragStart}
                                        onrangedoubleclick={onSegmentDoubleClick}
                                        onrangedurationchange={onSegmentDurationChange}
                                        onrangesourceoffsetchange={onSegmentSourceOffsetChange}
                                        height={row.height}
                                        key={row.key}>
                                        <template for:each={row.ranges} for:item="range">
                                            <ffmpeg-audiorange
                                                data-segment-id={range.segmentId}
                                                color={row.color}
                                                audio-window={editor}
                                                key={range.key}
                                                range={range.data}
                                            >
                                        </ffmpeg-audiorange>
                                        </template>
                                    </ffmpeg-gridrow>
                                </template>
                            </ffmpeg-grid>
                        </div>
                        <template if:true={cursorInWindow}>
                            <ffmpeg-cursor time={editor.cursor}></ffmpeg-cursor>
                        </template>
                        <template if:true={hasVirtualCursor}>
                            <ffmpeg-cursor time={editor.virtualCursor} virtual></ffmpeg-cursor>
                        </template>
                        <template if:true={hasPlaybackCursor}>
                            <ffmpeg-cursor time={playhead.currentTime} playhead></ffmpeg-cursor>
                        </template>
                        <template if:true={hasPlaybackDurationCursor}>
                            <ffmpeg-cursor
                                oncursordoubletap={onPlaybackDurationCursorDoubleTap}
                                oncursordrag={onPlaybackDurationCursorDrag}
                                time={playhead.playbackRange.duration}
                                user-drag>
                            </ffmpeg-cursor>
                        </template>
                        <template for:each={highlights} for:item="highlight">
                            <ffmpeg-highlight key={highlight.id} highlight={highlight}></ffmpeg-highlight>
                        </template>
                    </section>
                </template>
            </div>
        </template>
        <template if:true={isSegmentEditRoute}>
            <ffmpeg-segmentedit segment-id={route.params.segment_id}></ffmpeg-segmentedit>
        </template>
        <ffmpeg-masterout></ffmpeg-masterout>
    </main>
</template>
