<template>
    <header class="header">
        <ffmpeg-controls
            onsilencedetectbuttonclick={onSilenceDetectButtonClick}
            onstopbuttonclick={onStopButtonClick}
            onplaybuttonclick={onPlayButtonClick}>
        </ffmpeg-controls>
        <ffmpeg-audioscroll></ffmpeg-audioscroll>
        <ffmpeg-instruments></ffmpeg-instruments>
    </header>
    <aside class="selections">
        <section class="highlights">
            <template for:each={highlights} for:item="highlight">
                <ffmpeg-highlightdetail
                    key={highlight.id}
                    highlight={highlight}>
                </ffmpeg-highlightdetail>
            </template>
        </section>
    </aside>
    <main class="body">
        <template if:true={isEditorRoute}>
            <ffmpeg-selection></ffmpeg-selection>
            <ffmpeg-grid
                ongridaudiowindowcreated={onAudioTrackWindowCreated}
                class="track-grid"
                onaudiorangecreated={onTrackSegmentCreated}
                onaudiorangechange={onTrackSegmentRangeChange}
                rows={trackGridRows}
            >
                <section slot="col-left" class="tracks-summary">
                    <section class="tracks">
                        <template for:each={audioTracksArray} for:item="track" for:index="index">
                            <article data-track-id={track.id} onkeyup={onTrackSummaryKeyUp} tabindex="0" class="track track--summary" key={track.id}>
                                <span class="track-index">{index}</span>
                                <h4 class="track__title">{track.title}</h4>
                            </article>
                        </template>
                    </section>
                </section>
                <template if:true={hasAudioTrackWindowId} for:each={trackSegments} for:item="trackSegment">
                    <ffmpeg-audiorange
                        item-id={trackSegment.segment.id}
                        onrangedragstart={onSegmentDragStart}
                        onrangedragend={onSegmentDragEnd}
                        onrangedrag={onSegmentDrag}
                        onrangedoubleclick={onSegmentDoubleClick}
                        color={trackSegment.color}
                        rows={trackGridRows}
                        row-index={trackSegment.rowIndex}
                        audio-window={audioTrackWindow}
                        key={trackSegment.segment.id}
                        range={trackSegment.segment.range}
                    >
                    </ffmpeg-audiorange>
                </template>
            </ffmpeg-grid>
            <template if:true={cursorInWindow}>
                <ffmpeg-cursor time={editor.cursor}></ffmpeg-cursor>
            </template>
            <template if:true={hasVirtualCursor}>
                <ffmpeg-cursor time={editor.virtualCursor} virtual></ffmpeg-cursor>
            </template>
            <template if:true={hasPlaybackCursor}>
                <ffmpeg-cursor time={playhead.currentTime} playhead></ffmpeg-cursor>
            </template>
            <template if:true={hasPlaybackDurationCursor}>
                <ffmpeg-cursor
                    oncursordoubletap={onPlaybackDurationCursorDoubleTap}
                    oncursordrag={onPlaybackDurationCursorDrag}
                    time={playhead.playbackRange.duration}
                    user-drag>
                </ffmpeg-cursor>
            </template>
            <template for:each={highlights} for:item="highlight">
                <ffmpeg-highlight key={highlight.id} highlight={highlight}></ffmpeg-highlight>
            </template>
        </template>
        <template if:true={isSegmentEditRoute}>
            <ffmpeg-segmentedit segment-id={route.params.segment_id}></ffmpeg-segmentedit>
        </template>
    </main>
    <section class="master-out">
        <ffmpeg-masterout></ffmpeg-masterout>
    </section>
</template>
